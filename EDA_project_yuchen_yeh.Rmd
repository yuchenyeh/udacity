Data Exploration Red Wine Quality by Yuchen_Yeh
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=FALSE for all code chunks in your file.
library(plyr)
library(reshape2)
library(ggplot2)
library(ggthemes) 
```
Dataset citation:

P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis. 
Modeling wine preferences by data mining from physicochemical properties.
In Decision Support Systems, Elsevier, 47(4):547-553. ISSN: 0167-9236.

This report explores a dataset containing 1,500 red wines with 12 variables on the chemical properties of the wine.

```{r echo=FALSE, Load_the_Data}
# Load the Data
wqr <- read.csv('wineQualityReds.csv')
```

# Univariate Plots Section

### Summary of the data set
```{r echo=FALSE, message=FALSE, warning=FALSE,Univariate_Plots0}
str(wqr)
summary(wqr)
```

This sample data set is very tidy, and there are no missing values. Some variables saw large variances: the mean of residual sugar is 2.539g but the max is 15.5g. The max value of chlorides 0.611g (almost 7 times higher than the mean). Total sulfur dioxide ranges from 6g to 289g. 

### Quality of red wine
```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots1}
ggplot(wqr, aes(x= quality)) + geom_bar()
```

Each expert graded the wine quality between 0 (very bad) and 10 (very excellent).
For this red wine sample, the lowest grade is 3 and the highest grade is 8. Majority scored between 5 and 6 in an average range.

### pH level
```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots2}
qplot(x = pH, data = wqr,binwidth = 0.1) 
summary(wqr$pH)
```

Most red wines samples are between 3.0 - 3.5 on the pH scale. In general, the pH level of most wines is between 3-4, and I noticed in this sample the lowest pH is 2.74 and the highest pH is 4.010. 

Below, we subset the wine quality to see the distribution of pH level.

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots3}
quality78 <-subset(wqr, quality == 7 |quality == 8) #subset for quality 7 & 8
qplot(x = pH, data = quality78,binwidth = 0.1, main = "pH for High Quality Wines (grade 7 & 8)")
summary(quality78$pH)

quality34 <-subset(wqr, quality == 3|quality == 4) #subset for quality 3 & 4
qplot(x = pH, data = quality34,binwidth = 0.1, main = "pH for Low Quality Wines (grade 3 & 4)") 
summary(quality34$pH)
```

It shows that the pH distribution is varied depending on wine quality. Both distributions are normal but with different means and variances. The mean of high quality is slightly less than the mean of low quality, but the variance of low quality is much bigger. 

### Density of red wine

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots4}
qplot(x = density, data = wqr,binwidth = 0.001)
summary(wqr$density)
```

The density of most wines is very close to the density of water, and the density distribution is normal with values ranged from 0.9901 to 1.0040.

### Alchohol %

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots5}
qplot(x = alcohol, data = wqr, binwidth = 0.5) + scale_x_continuous(limits = c(8,15), breaks = seq(8,15,0.5))
summary(wqr$alcohol)
```

Alcohol level distribution looks skewed left. Most frequently wine samples have 9.5% alcohol.

### Acidity level: fixed acidity and volatile acidity

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots6}

qplot(x = fixed.acidity, data = wqr, binwidth = 1)+ scale_x_continuous(limits = c(4,16), breaks = seq(4,16,1))
summary(wqr$fixed.acidity)
qplot(x = volatile.acidity, data = wqr, binwidth = 0.1) + scale_x_continuous(limits = c(0,1.6), breaks = seq(0,1.6,0.1))
summary(wqr$volatile.acidity)
```

Fixed acidity, that does not evaporate readily, in most wines are in a range of between 7g and 9g. In terms of volatile acidity, most wines have between 0.3g and 0.7g. Around 150 wines have a high volatile acidity of above 8g, which can lead to an unpleasant, vinegar taste.

## Citric acid level

```{r echo=FALSE, warning=FALSE, message=FALSE,Univariate_Plots7}
qplot(x = citric.acid, data = wqr, binwidth = 0.05)+ scale_x_continuous(limits = c(0,1), breaks = seq(0,1,0.05))
summary(wqr$citric.acid)

```

Citric acid can add 'freshness' and flavour to wines, and most wine samples have a different level, ranging from 0.05g to 0.5g. However, there are fewer wines with citric acid of more than 0.5g.

## Residual sugar level

```{r echo=FALSE, warning=FALSE, message=FALSE, Univariate_Plots8}

qplot(x = residual.sugar, data = wqr, binwidth = 1)+ scale_x_continuous(limits = c(0,16), breaks = seq(0,16,1))

qplot(x = residual.sugar, data = wqr, binwidth = 0.1)+ scale_x_continuous(limits = c(1,4), breaks = seq(1,4,0.1)) #by looking between 1g and 4g

summary(wqr$residual.sugar)
```

Itâ€™s rare to find wines with less than 1 gram/liter and wines with greater than 45 grams/liter are considered sweet. The distribution of residual sugar for this red wine samples is heavily skewed to left, which means the wine samples tend to be less sweet. To examine closely the residual sugar distribution between 1g and 4g, the most frequent values are between 1.8g and 2.3g. 

## Chlorides level

```{r echo=FALSE, warning=FALSE, message=FALSE,Univariate_Plots9}

qplot(x = chlorides, data = wqr, binwidth = 0.1) + scale_x_continuous(limits = c(0,1), breaks = seq(0,1,0.1))
qplot(x = chlorides, data = wqr, binwidth = 0.01) + scale_x_continuous(limits = c(0,0.2), breaks = seq(0,0.2,0.01)) #limit to the data between 0g and 0.2g

summary(wqr$chlorides)
```

Chlorides represent the amount of salt in the wine. In this red wine data set, the most frequent value of chlorides is 0.1g. To see the distribution of chlorides clearer I limited the data between 0g and 0.2g to find a normal distribution with a mean of around 0.08g.

## Sulfur dioxide level

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots10}

qplot(x = free.sulfur.dioxide, data = wqr)
summary(wqr$free.sulfur.dioxide)
```

Free from of sulfur dioxide prevents microbial growth and the oxidation of wine, and most wines have in the range of 0mg - 20mg. It is noted that tens of samples with free sulfur dioxide concentrations over 50 ppm, which the taste of wine is affected.


```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots11}

qplot(x = total.sulfur.dioxide, data = wqr)
summary(wqr$total.sulfur.dioxide)

wqr$bound.sulfur.dioxide = wqr$total.sulfur.dioxide - wqr$free.sulfur.dioxide
qplot(x = bound.sulfur.dioxide , data = wqr)
summary(wqr$bound.sulfur.dioxide)

```

The total sulfur dioxide level in most wines vary between 0mg - 100g. To estimate the level of bound form of sulfur dioxide, I calculated the difference in a new variable called bound sulfur dioxide, and actually two-thirds of bound sulfur dioxide values is between 0g - 40g.

## Sulphates level

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots12}

qplot(x = sulphates, data = wqr)
summary(wqr$sulphates)

```

Sulphates are a wine additiive which can contribute to sulfur dioxide levels, and 0.5g - 1g of sulphates are observed in most wines.



# Univariate Analysis

### What is the structure of your dataset?
There are 1,500 red wines in the dataset with 12 variables on the chemical properties of the wine (fixed acidity, volatile acidity, citric acid, residual sugar, chlorides, free sulfur dioxide, total sulfur dioxide, density, pH, sulphates, alchol and quality). The only categorical variable is quality. All other variables are continuous variables. 

### What is/are the main feature(s) of interest in your dataset?
The main features in the data set are pH values and quality. I'd like to know if pH level decides the quality of wine. I suspect some other combined variables are also likely to help build a predicted model to grade wine quality.

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?
Volatile.acidity, citric acid, residual sugar and free sulfur dioxide likely contribute quality of the wine. 

### Did you create any new variables from existing variables in the dataset?
I created a new variable called bound sulfur dioxide by calculating the difference of total sulfur dioxide and free sulfur dioxide. 

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?
The distribution of residual sugar is heavily skewed to left, so I have to subset just part of the data between 0g and 4g to see better distribution. For chlorides, the distribution is also left-skewed, and I limited the data between 0g and 0.2g.


# Bivariate Plots Section

### Coefficient matrix

```{r echo=FALSE, BivariatePlots0}
# code reference: http://www.sthda.com/english/wiki/ggplot2-quick-correlation-matrix-heatmap-r-software-and-data-visualization

cormat <- round(cor(wqr[2:ncol(wqr)]),2)
cormat

# Get lower triangle of the correlation matrix
get_lower_tri<- function(cormat){
    cormat[upper.tri(cormat)] <- NA
    return(cormat)
}

# Get upper triangle of the correlation matrix
get_upper_tri <- function(cormat){
    cormat[lower.tri(cormat)]<- NA
    return(cormat)
  }
  
upper_tri <- get_upper_tri(cormat)
  
# Melt the correlation matrix

melted_cormat <- melt(upper_tri, na.rm = TRUE)
# Heatmap

ggplot(melted_cormat, aes(Var2, Var1, fill = value))+
 geom_tile(color = "white")+
 scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
    name="Pearson\nCorrelation") +
 theme_minimal()+ # minimal theme
 theme(axis.text.x = element_text(angle = 45, vjust = 1, 
    size = 12, hjust = 1))+
 coord_fixed()

```


From the correlation matrix, pH, residual sugar and free sulfur dioxide seem to have no correlations with quality, but quality has a negative moderate relationship with volatile acidity (-0.39), a positive moderate relationship (+0.48) with alcohol and a positive weak relationship with citric acid (0.23). 

Apart from the positive strong relationship between total sulfur dioxide and bound sulfur dioxide due to the previous calculation, there are two strong relationships in this data sets that I want to explore:
 a strong negative relationship (-0.50) between alcohol and density.
 a strong negative relationship (-0.55) between volatile.acidity and citric.acid.

 
### Quality with alcohol, volatile acidity and citric acid

```{r echo=FALSE, BivariatePlots1}
ggplot(wqr, aes(x = quality, y = alcohol)) +
   geom_boxplot(aes(group=quality)) +
   geom_smooth(method = 'lm') 

by(wqr$alcohol,wqr$quality,summary)

ggplot(wqr, aes(x = quality, y = volatile.acidity)) + 
   geom_boxplot(aes(group=quality))+
   geom_smooth(method = 'lm') 
  
by(wqr$volatile.acidity,wqr$quality,summary)

ggplot(wqr, aes(x = quality, y = citric.acid)) + 
  geom_boxplot(aes(group=quality)) +
   geom_smooth(method = 'lm') 
by(wqr$citric.acid,wqr$quality,summary)

```

The trend between quality and alcohol is very clear that when the alcohol percentage increases the quality improves. The relationship between quality and volatile acidity is negative, which means better quality is observed in lower volatile acidity. The slope is less steep between quality and citric acid, but it shows a higher level of citric acid contributes to a better quality of wine.

### Other variables

```{r echo=FALSE, BivariatePlots3}
ggplot(aes( x = density, y = alcohol), data = wqr) + geom_point() +
  geom_point(alpha = 1/4, position = position_jitter(h = 0), size = 3)+
  geom_smooth(method = 'lm') 

ggplot(aes( y = volatile.acidity, x = citric.acid), data = wqr) + geom_point() +
  geom_point(alpha = 1/4, position = position_jitter(h = 0), size = 3)+
  geom_smooth(method = 'lm') 

```

When density increases, the alcohol level decreases. Volatile acidity and citric acid also demonstrated a negative relationship. It is interesting to see that both variables are related to quality in some degree: volatile acidity has a negative relationship with quality and citric acid has a positive relationship with quality.

```{r echo=FALSE, BivariatePlots4}
ggplot(aes( x = pH, y = fixed.acidity ), data = wqr) + geom_point() +
  geom_point(alpha = 1/4, position = position_jitter(h = 0), size = 3)+
  geom_smooth(method = 'lm') 

```

It is not a surprise to see the strongest relationship is between pH and fixed acidity, as pH scale measure how acidic a substance is.

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

There are only two variables showing a slightly stronger relationship with quality: a negative moderate relationship with volatile acidity (-0.39), a positive moderate relationship (+0.48) with alcohol. Surprisingly, the pH level has a very weak relationship with quality (-0.06).

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

A total of 6 strong relationships:
 a strong negative relationship (-0.50) between alcohol and density.
 a strong negative relationship (-0.55) between volatile.acidity and citric.acid.
 a strong negative relationship (-0.68) between fixed acidity and pH,
  a strong negative relationship (-0.54) between pH and citric.acid,
 a strong positive relationship (+0.67) between fixed acidity and density, 
 a strong positive relationship (+0.67) between fixed acidity and citric.acid.

 
### What was the strongest relationship you found?
It is obvious that total sulfur dioxdie and bound sulfur dioxide have a very strong relationship (+0.96) as it was calculated by subtracting free sulfur dioxide. The strongest relationship is between pH and fixed acidity (-0.68), which is again quite reasonable as pH level goes against fixed acidity.


# Multivariate Plots Section

```{r echo=FALSE, Multivariate_Plots1}
ggplot(aes(x= density, y = alcohol), data = wqr) +  geom_point(aes(shape = factor(quality)),  size = 2.5) +geom_point(aes(color = factor(quality)),alpha = 1,  size = 2)

```

High-quality wine have a higher percentage of alcohol with a varied range of density between 0.990 and 1.000. On the other hand, low-quality wine has a lower percentage of alcohol with the density in a more defined range of 0.995 and 1.000.

```{r echo=FALSE, Multivariate_Plots2}
ggplot(aes(y = fixed.acidity, x = citric.acid), data = wqr) +  geom_point(aes(shape = factor(quality)),  size = 2.5) +geom_point(aes(color = factor(quality)),alpha = 1,  size = 2)

```

Low-quality wines see lower fixed acidity, especially with a lower citric acid. High-quality wines have a combination of higher citric acid and higher fixed acidity.

```{r echo=FALSE, Multivariate_Plots3}
ggplot(aes(y = pH ,x = citric.acid), data = wqr) +  geom_point(aes(shape = factor(quality)),  size = 2.5) +geom_point(aes(color = factor(quality)),alpha = 1,  size = 2)

```

High-quality wines have a combination of lower pH and higher citric acid, while low-quality wines sees a level of higher pH and lower citric acid.

```{r echo=FALSE, Multivariate_Plots4}
ggplot(wqr, aes(x = quality, y = free.sulfur.dioxide/total.sulfur.dioxide)) + 
   geom_boxplot(aes(group=quality))
```

It does not seem to have any relationship between the ratio of a free form of sulfur dioxide and quality of the red wines.

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

High-quality wines have a combination of lower pH and higher citric acid or a combination of higher citric acid and higher fixed acidity. Low-quality wines see a mix of higher pH and lower citric acid or a mix of lower fixed acidity and lower citric acid.

### Were there any interesting or surprising interactions between features?

High-quality wine have a higher percentage of alcohol but doesn't correlate with any particular of density.It is surprising to note that there is no correlation between the ratio of a free form of sulfur dioxide and quality of the red wines.


------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}
ggplot(wqr, aes(x= quality), xlab("fsd")) + geom_bar() +ggtitle("The distribution of wine quality") +labs(y="No. of wines")
```


### Description One
The majority of red wine samples are graded 5 and 6.

### Plot Two
```{r echo=FALSE, Plot_Two}
ggplot(wqr, aes(x = quality, y = alcohol)) +
   geom_boxplot(aes(group=quality)) +
   geom_smooth(method = 'lm') +ggtitle("The alcohol percentage for different wine quality") +labs(y="Alcohol %")

```

### Description Two
A positive moderate relationship is observed between alcohol percentage and wine quality. 

### Plot Three
```{r echo=FALSE, Plot_Three}
ggplot(aes(y = fixed.acidity, x = citric.acid), data = wqr) +  geom_point(aes(shape = factor(quality)),  size = 2.5) +
  geom_point(aes(color = factor(quality)),alpha = 1,  size = 2) +
  ggtitle("Wine quality with citric acid and fixed acidity")  +
labs(x ="citric acid (g)",y="fixed acidity (g) ")

```


### Description Three

There is a clear pattern that low-quality wines tend to have lower fixed acidity and a lower citric acid and high-quality wines have a combination of high citric acid and high fixed acidity.

------

# Reflection
This sample data set is very tidy, and there are no missing values. Some variables like residual sugar and chlorides saw large variances. By analysing the data, the conclusion can be drawn:

1. Mostly frequent quality levels of red wine are 5 and 6.

2. Quality increases when volatile acidity decreases and alcohol percentage increases.

3. High-quality wines have a combination of lower pH and higher citric acid or a combination of higher citric acid and higher fixed acidity. Low-quality wines see a mix of higher pH and lower citric acid or a mix of lower fixed acidity and lower citric acid.

4. pH and fixed acidity are positive correlated as pH scale measure how acidic a substance is.

5. When alcohol percentage decreases, density grows.

To my surprise, pH level doesn't have a strong correlation with quality. I also explored the relationship between the ratio of a free form of sulfur dioxide and quality of the red wines, but I didn't see any correlation.

It seems like the quality grading by experts doesn't purely based on 12 variables provided in the data set. It would be interesting to analyse the red quality quality by the year of production, the place of the product, etc.
 
 